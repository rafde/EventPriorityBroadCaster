!function(t,n){"use strict";var i="PrioritizedSubPub";"function"==typeof define&&define.amd?define(i,n(t)):"object"==typeof module&&"object"==typeof module.exports?module.exports=n(t):t[i]=n(t)}(this,function(){"use strict";function t(t,n,i){var e;try{e=t.apply(i,n)}catch(u){r(u)}return e}function n(t){return"number"==typeof t&&!isNaN(t)}function i(t){return y(t)||t===!0}function e(t){return l(t)?t:v(t)?[t]:void 0}function u(t,n){var i,e,u=0,r=t.length;if(!r||(r-=1)&&t[r]<n)return t.push(n),r;if(t[u]>n)return t.unshift(n),u;for(;r>=u;)if(i=(u+r)/2|0,e=t[i],e>n)r=i-1;else if(u=i+1,e===n)return;return t.splice(u,0,n),u}function r(){var t;f.isLogged&&"undefined"!=typeof console&&d(console.log)&&(t=I(arguments),t.unshift("PSP: "),console.log(t))}function s(t,n){for(var i,e=0,u={};i=p[e++];)"def"!==i?u[i]={t:{},q:[]}:u[i]=null;this.sI={},this.hP=!1,this.oA=[{}],this.t=u,this.eN=n+t+"-> "}function o(t){var n=t;this.sL={},v(n)||(n="PSP"+Math.ceil(1e7*Math.random())),this.pN=n+"::"}function c(t){function n(){i.exec.apply(i,arguments)}var i=new o(t);return n.pub=function(){return i.pub.apply(i,arguments),this},n.sub=function(){return i.sub.apply(i,arguments),this},n.unSub=function(){return i.unSub.apply(i,arguments),this},n.getEventPubCallback=function(t){return function(){n.pub(t,I(arguments))}},n.getEventProxy=function(t){return{pub:function(i){return n.pub(t,i),this},sub:function(i){return n.sub(t,i),this},unSub:function(i){return n.unSub(t,i),this}}},n}function f(t){return y(this)||this===window?(h.apply(h,arguments),f):v(t)?new c(t):void 0}var h,p=["pre","def","post"],b="unsub",a="skip_dec",l=function(t){return"[object Array]"===Object.prototype.toString.call(t)},d=function(t){return"function"==typeof t},g=function(t){return t&&"object"==typeof t},S=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},v=function(t){return"string"==typeof t},y=function(t){return void 0===t},I=function(t){return Array.prototype.slice.call(t)},m=function(t,n){if(t.indexOf)return t.indexOf(n);var i=0;if(t&&t.length)do if(t[i]===n)return i;while(t[++i]);return-1};return"undefined"!=typeof _&&(l=_.isArray,d=_.isFunction,g=_.isObject,S=_.isRegExp,v=_.isString,y=_.isUndefined,I=_.toArray,m=_.indexOf),s.prototype={constructor:s,reSI:function(t){var n,i=t.t,e=t.sI,r=t.p,s=this.t[i];return this.rmSI(e,!1),t.c=0,this.sI[e]=t,"def"===i?(this.rmSI(s),void(this.t[i]=e)):(n=s.t[r],y(n)&&(n=s.t[r]=[],u(s.q,r)),void n.push(e))},rmSI:function(t,n){var e,u,s,o;return v(t)&&(e=this.sI[t])&&g(e)?(o=this.t[e.t],v(o)?(r(this.eN+"removing default timing"),this.t[e.t]=null):o&&o.q.length&&(s=o.t[e.p])&&s.length&&(u=m(s,t))>=0&&s.splice(u,1),i(n)&&(delete this.sI[t],r(this.eN+" is completely erasing "+t)),!0):(r(this.eN+" had nothing to remove for "+t),!1)},rmSIR:function(t){var n,i=this.sI;for(n in i)i.hasOwnProperty(n)&&t.test(n)&&this.rmSI(n)},p2S:function(i,e){var u,s,o;return e=e||this.oA,v(i)&&(u=this.sI[i])?((!(s=n(u.uSC))||s&&u.uSC>0)&&(o=t(u.s,e.concat([{subscription:{id:i,count:++u.c,context:u.ct},publisher:{},CONST:{SKIP_DEC:a,UNSUB:b}}]),u.ct)),o===b||o!==a&&s&&--u.uSC<=0?(r(this.eN+"Subscriber subId "+i+" removed itself. Result:",o),this.rmSI(i),!1):!0):null},publish:function(t,n){var i,e,u,s,o,c,f,h,b=0;for(this.oA=t,this.hP=!0;i=p[b++];)if(u=this.t[i],"def"===i)v(u)&&(r(this.eN+"Publishing to default"),this.p2S(u,t,n));else if((f=u.q)&&(e=f.length))for(;0===(h=f[--e])||h;)if(s=u.t[h],s&&s.length)for(o=0;c=s[o];)r(this.eN+"Publishing subId "+c+" TIMING "+i+" PRIORITY "+e),this.p2S(c,t,n)&&o++}},o.prototype={constructor:o,pub:function(t,n,i){var u,r=e(t),s=0;if(l(r)){n=l(n)?n:g(n)?[n]:[{}],u=r[s];do v(u)&&(u=this.getSub(u),u&&u.publish(n,i));while(u=t[++s])}},sub:function(t,i){var e,u,s=typeof i,o="function"===s,c={};return v(t)&&i&&(o||"object"===s&&d(i.sub)&&(y(u=i.unSubCount)||(u=parseInt(u,10))>0))?(u&&(c.uSC=u),c.s=o?i:i.sub,c.sI=v(u=i.subId)?u:"pr-"+Math.ceil(1e7*Math.random()),c.p=n(u=+i.priority)?u:0,c.t=(u=m(p,i.timing))<0?p[0]:p[u],y(u=i.context)||(c.ct=u),e=this.getSub(t),e.reSI(c),i.rePub&&e.hP&&(r(this.pN+t+" event was published. Re-publish subId "+c.sI),e.p2S(c.sI)),!0):(r(this.pN+t+" was not given a legitimate config"),null)},unSub:function(t,n){var i,u,s,o=0;if(v(t)&&(i=this.getSub(t,!1))){if(S(n))return void i.rmSIR(n);if(u=e(n),l(u)){s=u[o];do r(this.pN+"un-subscribing subId "+s+" from "+t),i.rmSI(s);while(s=u[++o])}}},getSub:function(t,n){var e=this.sL[t];return!e&&i(n)&&(r(this.pN+"Creating new subscription: "+t),this.sL[t]=e=new s(t,this.pN)),e},exec:function(t,n){var i,e,u;n=n||{},n&&v(t)?(e="object"==(i=typeof n),"function"===i||e&&d(n.sub)?null===this.sub(t,n)&&r(this.pN+"Subscription definition was invalid and was not registered"):e&&(u=n.unSub,v(u)||l(u)||S(u)?this.unSub(t,u):(n=n.pub||n,this.pub(t,n)))):l(t)&&this.pub(t,n)}},h=new c("GLOBAL"),f.sub=h.sub,f.pub=h.pub,f.unSub=h.unSub,f.getEventPubCallback=h.getEventPubCallback,f.getEventProxy=h.getEventProxy,f.isLogged=!0,f});